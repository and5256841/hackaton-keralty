<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrador - Gemelo Digital</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #2563EB;
            --primary-green: #10B981;
            --primary-red: #EF4444;
            --primary-yellow: #F59E0B;
            --bg-dark: #1F2937;
            --bg-light: #F9FAFB;
            --text-dark: #111827;
            --text-light: #6B7280;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            padding: 0;
            margin: 0;
        }

        /* HEADER */
        .admin-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #1E40AF 100%);
            color: white;
            padding: 30px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .admin-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* CONTAINER */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* KPI CARDS */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .kpi-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .kpi-card-title {
            font-size: 14px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-icon {
            font-size: 32px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .kpi-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .kpi-change.positive {
            color: var(--primary-green);
        }

        .kpi-change.negative {
            color: var(--primary-red);
        }

        /* CHARTS SECTION */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            font-size: 18px;
            color: var(--text-dark);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* FILTERS */
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .filters-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            display: block;
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .filter-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .filter-button {
            padding: 10px 20px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .filter-button:hover {
            background: #1E40AF;
        }

        .filter-button.reset {
            background: var(--text-light);
        }

        .filter-button.reset:hover {
            background: #4B5563;
        }

        /* TABLE */
        .table-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .table-header h3 {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .table-header p {
            font-size: 14px;
            color: var(--text-light);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-light);
        }

        th {
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: var(--bg-light);
        }

        td {
            padding: 16px;
            font-size: 14px;
        }

        /* BADGES */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.enrolled {
            background: #DCFCE7;
            color: #166534;
        }

        .badge.not-enrolled {
            background: #FEE2E2;
            color: #991B1B;
        }

        .badge.scheduled {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .badge.high {
            background: #FEE2E2;
            color: #991B1B;
        }

        .badge.medium {
            background: #FEF3C7;
            color: #92400E;
        }

        .badge.low {
            background: #DCFCE7;
            color: #166534;
        }

        /* HEALTH BAR */
        .health-bar-container {
            width: 100px;
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }

        .health-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .health-bar.excellent {
            background: linear-gradient(90deg, #10B981, #059669);
        }

        .health-bar.good {
            background: linear-gradient(90deg, #3B82F6, #2563EB);
        }

        .health-bar.fair {
            background: linear-gradient(90deg, #F59E0B, #D97706);
        }

        .health-bar.poor {
            background: linear-gradient(90deg, #EF4444, #DC2626);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .filters-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        /* EXPORT BUTTON */
        .export-button {
            padding: 10px 20px;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .export-button:hover {
            background: #059669;
        }

        /* OCR BUTTON */
        .ocr-button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .ocr-button:hover {
            background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
            padding: 24px;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-body {
            padding: 32px;
        }

        .close-button {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .close-button:hover {
            opacity: 1;
        }

        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
            background: var(--bg-light);
        }

        .upload-area.dragover {
            border-color: var(--primary-blue);
            background: #EEF2FF;
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            margin-top: 16px;
            padding: 12px 32px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .upload-button:hover {
            background: #1E40AF;
        }

        .upload-button:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }

        .file-selected {
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            display: none;
        }

        .progress-container {
            margin-top: 16px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6, #7C3AED);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            margin-top: 8px;
            font-size: 14px;
            color: var(--text-light);
            text-align: center;
        }

        .result-preview {
            margin-top: 24px;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 12px;
            display: none;
        }

        .result-preview h4 {
            margin: 0 0 16px 0;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-data {
            font-size: 14px;
            line-height: 1.8;
        }

        .result-data strong {
            color: var(--text-dark);
        }

        .hipaa-notice {
            margin-top: 16px;
            padding: 12px;
            background: #FEF3C7;
            border-left: 4px solid #F59E0B;
            border-radius: 4px;
            font-size: 13px;
            color: #92400E;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }

        .alert.success {
            background: #DCFCE7;
            color: #166534;
            border: 1px solid #10B981;
        }

        .alert.error {
            background: #FEE2E2;
            color: #991B1B;
            border: 1px solid #EF4444;
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="admin-header">
        <h1>üè• Dashboard Administrador - Gemelo Digital</h1>
        <p>Panel de control y m√©tricas de la plataforma de salud</p>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="container">

        <!-- OCR BUTTON -->
        <div style="margin-bottom: 32px; display: flex; justify-content: center;">
            <button class="ocr-button" onclick="openOCRModal()">
                <span style="font-size: 24px;">üìÑ</span>
                <span>OCR Historia Cl√≠nica</span>
            </button>
        </div>

        <!-- KPI CARDS -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-card-header">
                    <span class="kpi-card-title">Pacientes Totales</span>
                    <span class="kpi-icon">üë•</span>
                </div>
                <div class="kpi-value" id="totalPatients">30</div>
                <div class="kpi-change positive">
                    <span>‚Üë 12%</span>
                    <span>vs mes anterior</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-card-header">
                    <span class="kpi-card-title">Enrollment Rate</span>
                    <span class="kpi-icon">üìä</span>
                </div>
                <div class="kpi-value" id="enrollmentRate" style="color: var(--primary-green);">85%</div>
                <div class="kpi-change positive">
                    <span>‚Üë +55%</span>
                    <span>vs objetivo (30%)</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-card-header">
                    <span class="kpi-card-title">Citas Agendadas</span>
                    <span class="kpi-icon">üìÖ</span>
                </div>
                <div class="kpi-value" id="scheduledAppointments" style="color: var(--primary-blue);">23</div>
                <div class="kpi-change positive">
                    <span>‚Üë 90%</span>
                    <span>de inscritos agendaron</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-card-header">
                    <span class="kpi-card-title">Salud Promedio</span>
                    <span class="kpi-icon">‚ù§Ô∏è</span>
                </div>
                <div class="kpi-value" id="avgHealth" style="color: var(--primary-blue);">78%</div>
                <div class="kpi-change positive">
                    <span>‚Üë +8%</span>
                    <span>mejora √∫ltimos 30 d√≠as</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-card-header">
                    <span class="kpi-card-title">Puntos Promedio</span>
                    <span class="kpi-icon">‚≠ê</span>
                </div>
                <div class="kpi-value" id="avgPoints">1,245</div>
                <div class="kpi-change positive">
                    <span>‚Üë +320</span>
                    <span>engagement alto</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="kpi-card-header">
                    <span class="kpi-card-title">Racha Promedio</span>
                    <span class="kpi-icon">üî•</span>
                </div>
                <div class="kpi-value" id="avgStreak">12</div>
                <div class="kpi-change positive">
                    <span>d√≠as</span>
                    <span>retenci√≥n excelente</span>
                </div>
            </div>
        </div>

        <!-- CHARTS -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìä Distribuci√≥n por Programa</h3>
                <div class="chart-container">
                    <canvas id="programsChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>üìà Salud Promedio por Grupo de Edad</h3>
                <div class="chart-container">
                    <canvas id="healthByAgeChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>üèôÔ∏è Distribuci√≥n por Ciudad</h3>
                <div class="chart-container">
                    <canvas id="citiesChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>‚è∞ Horarios M√°s Solicitados</h3>
                <div class="chart-container">
                    <canvas id="timeSlotsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- FILTERS -->
        <div class="filters-section">
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">üîç Buscar paciente</label>
                    <input type="text" class="filter-input" id="searchInput" placeholder="Nombre, DNI, ciudad...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">üìã Programa</label>
                    <select class="filter-input" id="programFilter">
                        <option value="">Todos los programas</option>
                        <option value="HYPERTENSION">Hipertensi√≥n</option>
                        <option value="DIABETES">Diabetes</option>
                        <option value="OBESITY">Obesidad</option>
                        <option value="CARDIOVASCULAR">Cardiovascular</option>
                        <option value="PRENATAL">Prenatal</option>
                        <option value="PEDIATRIC">Pedi√°trico</option>
                        <option value="GERIATRIC">Geri√°trico</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">üèôÔ∏è Ciudad</label>
                    <select class="filter-input" id="cityFilter">
                        <option value="">Todas las ciudades</option>
                        <option value="bogota">Bogot√°</option>
                        <option value="medellin">Medell√≠n</option>
                        <option value="cali">Cali</option>
                        <option value="barranquilla">Barranquilla</option>
                        <option value="cartagena">Cartagena</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px; align-items: flex-end;">
                    <button class="filter-button" onclick="applyFilters()">Filtrar</button>
                    <button class="filter-button reset" onclick="resetFilters()">Resetear</button>
                    <button class="export-button" onclick="exportToCSV()">
                        <span>üì•</span>
                        <span>Exportar CSV</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- TABLE -->
        <div class="table-card">
            <div class="table-header">
                <h3>üìã Lista de Pacientes</h3>
                <p id="tableInfo">Mostrando 30 de 30 pacientes</p>
            </div>
            <div class="table-container">
                <table id="patientsTable">
                    <thead>
                        <tr>
                            <th>DNI</th>
                            <th>Nombre</th>
                            <th>Edad</th>
                            <th>Ciudad</th>
                            <th>Programa</th>
                            <th>Estado</th>
                            <th>Salud</th>
                            <th>Puntos</th>
                            <th>Racha</th>
                            <th>√öltima Actividad</th>
                        </tr>
                    </thead>
                    <tbody id="patientsTableBody">
                        <tr>
                            <td colspan="10" class="loading">Cargando pacientes...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- OCR MODAL -->
    <div id="ocrModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-button" onclick="closeOCRModal()">&times;</span>
                <h2>
                    <span>üìÑ</span>
                    <span>OCR Historia Cl√≠nica</span>
                </h2>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-light); margin-bottom: 24px;">
                    Sube un PDF de historia cl√≠nica no estructurada. El sistema extraer√° autom√°ticamente
                    los datos del paciente usando IA y crear√° un nuevo registro en la base de datos.
                </p>

                <!-- Upload Area -->
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('pdfFileInput').click()">
                    <div class="upload-icon">üì§</div>
                    <h3 style="margin-bottom: 8px;">Arrastra un PDF aqu√≠ o haz clic para seleccionar</h3>
                    <p style="color: var(--text-light); font-size: 14px;">Solo archivos PDF (m√°x. 10 MB)</p>
                </div>

                <input type="file" id="pdfFileInput" class="file-input" accept=".pdf" onchange="handleFileSelect(event)">

                <!-- File Selected Info -->
                <div class="file-selected" id="fileSelected">
                    <strong>Archivo seleccionado:</strong> <span id="fileName"></span>
                    <br>
                    <strong>Tama√±o:</strong> <span id="fileSize"></span>
                </div>

                <!-- Upload Button -->
                <button class="upload-button" id="uploadButton" onclick="uploadHistoriaClinica()" disabled>
                    Procesar Historia Cl√≠nica
                </button>

                <!-- Progress Bar -->
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Procesando PDF...</div>
                </div>

                <!-- Alerts -->
                <div class="alert success" id="successAlert"></div>
                <div class="alert error" id="errorAlert"></div>

                <!-- Result Preview -->
                <div class="result-preview" id="resultPreview">
                    <h4>
                        <span>‚úÖ</span>
                        <span>Paciente Creado Exitosamente</span>
                    </h4>
                    <div class="result-data" id="resultData"></div>
                    <div class="hipaa-notice">
                        ‚ö†Ô∏è <strong>Nota HIPAA:</strong> El PDF ha sido procesado en memoria y descartado.
                        Solo los datos estructurados han sido almacenados en la base de datos.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // DATOS DE PACIENTES SINT√âTICOS
        // ========================================
        const PATIENTS_DATA = [
            { dni: '1032456789', name: 'Mar√≠a Gonz√°lez', age: 45, city: 'bogota', program: 'DIABETES', enrolled: true, scheduled: true, health: 68, points: 990, streak: 8, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Reina Sof√≠a', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1098765432', name: 'Carlos Rodr√≠guez', age: 48, city: 'bogota', program: 'CARDIOVASCULAR', enrolled: true, scheduled: true, health: 80, points: 1240, streak: 14, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Universitaria Colombia', timeSlot: '2:00 PM - 4:00 PM' },
            { dni: '1045678901', name: 'Ana Mart√≠nez', age: 52, city: 'medellin', program: 'HYPERTENSION', enrolled: true, scheduled: true, health: 72, points: 1150, streak: 11, lastActivity: '2025-11-18', clinic: 'Cl√≠nica Colsanitas Medell√≠n', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1056789012', name: 'Luis Hern√°ndez', age: 38, city: 'cali', program: 'OBESITY', enrolled: true, scheduled: false, health: 65, points: 820, streak: 6, lastActivity: '2025-11-17', clinic: 'Cl√≠nica Colsanitas Torre de Cali', timeSlot: '4:00 PM - 6:00 PM' },
            { dni: '1067890123', name: 'Carmen Silva', age: 61, city: 'barranquilla', program: 'DIABETES', enrolled: true, scheduled: true, health: 70, points: 1090, streak: 9, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Colsanitas Barranquilla', timeSlot: '7:00 AM - 9:00 AM' },
            { dni: '1078901234', name: 'Jorge P√©rez', age: 29, city: 'bogota', program: 'CARDIOVASCULAR', enrolled: false, scheduled: false, health: 85, points: 450, streak: 3, lastActivity: '2025-11-15', clinic: null, timeSlot: null },
            { dni: '1089012345', name: 'Laura L√≥pez', age: 34, city: 'medellin', program: 'PRENATAL', enrolled: true, scheduled: true, health: 88, points: 1380, streak: 15, lastActivity: '2025-11-19', clinic: 'Centro M√©dico Colsanitas El Poblado', timeSlot: '11:00 AM - 1:00 PM' },
            { dni: '1090123456', name: 'Diego Torres', age: 56, city: 'cali', program: 'HYPERTENSION', enrolled: true, scheduled: true, health: 75, points: 1210, streak: 12, lastActivity: '2025-11-19', clinic: 'Centro M√©dico Colsanitas Norte', timeSlot: '2:00 PM - 4:00 PM' },
            { dni: '1023456780', name: 'Sof√≠a Ram√≠rez', age: 12, city: 'bogota', program: 'PEDIATRIC', enrolled: true, scheduled: true, health: 95, points: 1850, streak: 21, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Infantil Colsubsidio', timeSlot: '4:00 PM - 6:00 PM' },
            { dni: '1034567891', name: 'Roberto Vargas', age: 67, city: 'cartagena', program: 'GERIATRIC', enrolled: true, scheduled: true, health: 73, points: 1050, streak: 10, lastActivity: '2025-11-18', clinic: 'Cl√≠nica Colsanitas Cartagena', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1045678902', name: 'Patricia G√≥mez', age: 42, city: 'medellin', program: 'DIABETES', enrolled: true, scheduled: true, health: 69, points: 980, streak: 7, lastActivity: '2025-11-19', clinic: 'Centro M√©dico Colsanitas Laureles', timeSlot: '7:00 AM - 9:00 AM' },
            { dni: '1056789013', name: 'Fernando Castro', age: 51, city: 'bogota', program: 'OBESITY', enrolled: true, scheduled: false, health: 64, points: 790, streak: 5, lastActivity: '2025-11-16', clinic: 'Centro M√©dico Colsanitas Suba', timeSlot: '6:00 PM - 8:00 PM' },
            { dni: '1067890124', name: 'Isabel Morales', age: 78, city: 'bogota', program: 'GERIATRIC', enrolled: true, scheduled: true, health: 70, points: 620, streak: 5, lastActivity: '2025-11-19', clinic: 'Cl√≠nica La Colina', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1078901235', name: 'Andr√©s Jim√©nez', age: 44, city: 'cali', program: 'HYPERTENSION', enrolled: true, scheduled: true, health: 74, points: 1180, streak: 11, lastActivity: '2025-11-18', clinic: 'Centro M√©dico Colsanitas Sur', timeSlot: '11:00 AM - 1:00 PM' },
            { dni: '1089012346', name: 'Claudia Ruiz', age: 36, city: 'medellin', program: 'CARDIOVASCULAR', enrolled: false, scheduled: false, health: 82, points: 520, streak: 4, lastActivity: '2025-11-14', clinic: null, timeSlot: null },
            { dni: '1090123457', name: 'Miguel S√°nchez', age: 59, city: 'barranquilla', program: 'DIABETES', enrolled: true, scheduled: true, health: 71, points: 1120, streak: 10, lastActivity: '2025-11-19', clinic: 'Centro M√©dico Colsanitas Norte', timeSlot: '2:00 PM - 4:00 PM' },
            { dni: '1023456781', name: 'Valentina Ortiz', age: 8, city: 'bogota', program: 'PEDIATRIC', enrolled: true, scheduled: true, health: 97, points: 1920, streak: 23, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Infantil Colsubsidio', timeSlot: '4:00 PM - 6:00 PM' },
            { dni: '1034567892', name: 'Ricardo Delgado', age: 63, city: 'cali', program: 'GERIATRIC', enrolled: true, scheduled: true, health: 72, points: 1040, streak: 9, lastActivity: '2025-11-18', clinic: 'Cl√≠nica Colsanitas Torre de Cali', timeSlot: '7:00 AM - 9:00 AM' },
            { dni: '1045678903', name: 'Beatriz Navarro', age: 47, city: 'medellin', program: 'OBESITY', enrolled: true, scheduled: true, health: 66, points: 850, streak: 7, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Las Am√©ricas', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1056789014', name: 'Javier Rojas', age: 33, city: 'cartagena', program: 'CARDIOVASCULAR', enrolled: true, scheduled: false, health: 83, points: 1310, streak: 13, lastActivity: '2025-11-17', clinic: 'Centro M√©dico Colsanitas Bocagrande', timeSlot: '2:00 PM - 4:00 PM' },
            { dni: '1067890125', name: 'Gabriela Mendoza', age: 28, city: 'bogota', program: 'PRENATAL', enrolled: true, scheduled: true, health: 90, points: 1450, streak: 16, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Reina Sof√≠a', timeSlot: '11:00 AM - 1:00 PM' },
            { dni: '1078901236', name: 'H√©ctor Fuentes', age: 54, city: 'medellin', program: 'HYPERTENSION', enrolled: true, scheduled: true, health: 76, points: 1230, streak: 12, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Colsanitas Medell√≠n', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1089012347', name: 'Natalia Cruz', age: 41, city: 'cali', program: 'DIABETES', enrolled: false, scheduled: false, health: 67, points: 480, streak: 3, lastActivity: '2025-11-13', clinic: null, timeSlot: null },
            { dni: '1090123458', name: 'Sergio Medina', age: 72, city: 'barranquilla', program: 'GERIATRIC', enrolled: true, scheduled: true, health: 71, points: 980, streak: 8, lastActivity: '2025-11-18', clinic: 'Centro M√©dico Colsanitas Riomar', timeSlot: '7:00 AM - 9:00 AM' },
            { dni: '1023456782', name: 'Carolina Vega', age: 49, city: 'bogota', program: 'OBESITY', enrolled: true, scheduled: true, health: 65, points: 820, streak: 6, lastActivity: '2025-11-19', clinic: 'Centro M√©dico Colsanitas El Polo', timeSlot: '4:00 PM - 6:00 PM' },
            { dni: '1034567893', name: 'Daniel Parra', age: 35, city: 'medellin', program: 'CARDIOVASCULAR', enrolled: true, scheduled: true, health: 84, points: 1340, streak: 14, lastActivity: '2025-11-19', clinic: 'Centro M√©dico Colsanitas El Poblado', timeSlot: '2:00 PM - 4:00 PM' },
            { dni: '1045678904', name: 'Liliana Ramos', age: 57, city: 'cali', program: 'DIABETES', enrolled: true, scheduled: true, health: 70, points: 1100, streak: 10, lastActivity: '2025-11-18', clinic: 'Centro M√©dico Colsanitas Norte', timeSlot: '9:00 AM - 11:00 AM' },
            { dni: '1056789015', name: 'Esteban Molina', age: 10, city: 'bogota', program: 'PEDIATRIC', enrolled: true, scheduled: true, health: 96, points: 1880, streak: 22, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Infantil Colsubsidio', timeSlot: '4:00 PM - 6:00 PM' },
            { dni: '1067890126', name: 'Mariana R√≠os', age: 31, city: 'cartagena', program: 'PRENATAL', enrolled: true, scheduled: true, health: 89, points: 1420, streak: 15, lastActivity: '2025-11-19', clinic: 'Cl√≠nica Colsanitas Cartagena', timeSlot: '11:00 AM - 1:00 PM' },
            { dni: '1078901237', name: 'Pablo Acosta', age: 65, city: 'medellin', program: 'GERIATRIC', enrolled: true, scheduled: false, health: 73, points: 1060, streak: 9, lastActivity: '2025-11-17', clinic: 'Cl√≠nica Colsanitas Medell√≠n', timeSlot: '7:00 AM - 9:00 AM' }
        ];

        // Store original data
        let allPatients = [...PATIENTS_DATA];
        let filteredPatients = [...PATIENTS_DATA];

        // ========================================
        // PROGRAM NAMES
        // ========================================
        const PROGRAM_NAMES = {
            'HYPERTENSION': 'Hipertensi√≥n',
            'DIABETES': 'Diabetes',
            'OBESITY': 'Obesidad',
            'CARDIOVASCULAR': 'Cardiovascular',
            'PRENATAL': 'Prenatal',
            'PEDIATRIC': 'Pedi√°trico',
            'GERIATRIC': 'Geri√°trico'
        };

        // ========================================
        // CITY NAMES
        // ========================================
        const CITY_NAMES = {
            'bogota': 'Bogot√°',
            'medellin': 'Medell√≠n',
            'cali': 'Cali',
            'barranquilla': 'Barranquilla',
            'cartagena': 'Cartagena'
        };

        // ========================================
        // CALCULATE KPIs
        // ========================================
        function calculateKPIs() {
            const total = filteredPatients.length;
            const enrolled = filteredPatients.filter(p => p.enrolled).length;
            const scheduled = filteredPatients.filter(p => p.scheduled).length;
            const avgHealth = Math.round(filteredPatients.reduce((sum, p) => sum + p.health, 0) / total);
            const avgPoints = Math.round(filteredPatients.reduce((sum, p) => sum + p.points, 0) / total);
            const avgStreak = Math.round(filteredPatients.reduce((sum, p) => sum + p.streak, 0) / total);
            const enrollmentRate = Math.round((enrolled / total) * 100);

            document.getElementById('totalPatients').textContent = total;
            document.getElementById('enrollmentRate').textContent = enrollmentRate + '%';
            document.getElementById('scheduledAppointments').textContent = scheduled;
            document.getElementById('avgHealth').textContent = avgHealth + '%';
            document.getElementById('avgPoints').textContent = avgPoints.toLocaleString();
            document.getElementById('avgStreak').textContent = avgStreak;
        }

        // ========================================
        // RENDER TABLE
        // ========================================
        function renderTable() {
            const tbody = document.getElementById('patientsTableBody');

            if (filteredPatients.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="loading">No se encontraron pacientes con los filtros aplicados</td></tr>';
                document.getElementById('tableInfo').textContent = 'Mostrando 0 de ' + allPatients.length + ' pacientes';
                return;
            }

            tbody.innerHTML = filteredPatients.map(patient => {
                const healthClass = patient.health >= 80 ? 'excellent' : patient.health >= 70 ? 'good' : patient.health >= 60 ? 'fair' : 'poor';

                return `
                    <tr>
                        <td><strong>${patient.dni}</strong></td>
                        <td>${patient.name}</td>
                        <td>${patient.age} a√±os</td>
                        <td>${CITY_NAMES[patient.city]}</td>
                        <td>${PROGRAM_NAMES[patient.program]}</td>
                        <td>
                            <span class="badge ${patient.enrolled ? 'enrolled' : 'not-enrolled'}">${patient.enrolled ? '‚úì Inscrito' : '‚óã No inscrito'}</span>
                            ${patient.scheduled ? '<span class="badge scheduled">üìÖ Agendado</span>' : ''}
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="health-bar-container">
                                    <div class="health-bar ${healthClass}" style="width: ${patient.health}%"></div>
                                </div>
                                <span><strong>${patient.health}%</strong></span>
                            </div>
                        </td>
                        <td><strong>${patient.points.toLocaleString()}</strong></td>
                        <td>${patient.streak} d√≠as üî•</td>
                        <td>${patient.lastActivity}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('tableInfo').textContent = `Mostrando ${filteredPatients.length} de ${allPatients.length} pacientes`;
        }

        // ========================================
        // CHARTS
        // ========================================
        let programsChart, healthByAgeChart, citiesChart, timeSlotsChart;

        function createCharts() {
            // Programs Chart
            const programCounts = {};
            filteredPatients.forEach(p => {
                programCounts[p.program] = (programCounts[p.program] || 0) + 1;
            });

            const programsCtx = document.getElementById('programsChart').getContext('2d');
            programsChart = new Chart(programsCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(programCounts).map(k => PROGRAM_NAMES[k]),
                    datasets: [{
                        data: Object.values(programCounts),
                        backgroundColor: [
                            '#EF4444', '#F59E0B', '#10B981', '#3B82F6',
                            '#8B5CF6', '#EC4899', '#6366F1'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Health by Age Chart
            const ageGroups = {
                '0-18': [],
                '19-35': [],
                '36-50': [],
                '51-65': [],
                '66+': []
            };

            filteredPatients.forEach(p => {
                if (p.age <= 18) ageGroups['0-18'].push(p.health);
                else if (p.age <= 35) ageGroups['19-35'].push(p.health);
                else if (p.age <= 50) ageGroups['36-50'].push(p.health);
                else if (p.age <= 65) ageGroups['51-65'].push(p.health);
                else ageGroups['66+'].push(p.health);
            });

            const avgHealthByAge = Object.keys(ageGroups).map(key => {
                const ages = ageGroups[key];
                return ages.length > 0 ? Math.round(ages.reduce((a, b) => a + b, 0) / ages.length) : 0;
            });

            const healthByAgeCtx = document.getElementById('healthByAgeChart').getContext('2d');
            healthByAgeChart = new Chart(healthByAgeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(ageGroups),
                    datasets: [{
                        label: 'Salud Promedio (%)',
                        data: avgHealthByAge,
                        backgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Cities Chart
            const cityCounts = {};
            filteredPatients.forEach(p => {
                cityCounts[p.city] = (cityCounts[p.city] || 0) + 1;
            });

            const citiesCtx = document.getElementById('citiesChart').getContext('2d');
            citiesChart = new Chart(citiesCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(cityCounts).map(k => CITY_NAMES[k]),
                    datasets: [{
                        label: 'Pacientes',
                        data: Object.values(cityCounts),
                        backgroundColor: '#10B981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Time Slots Chart
            const timeSlotCounts = {};
            filteredPatients.filter(p => p.timeSlot).forEach(p => {
                timeSlotCounts[p.timeSlot] = (timeSlotCounts[p.timeSlot] || 0) + 1;
            });

            const timeSlotsCtx = document.getElementById('timeSlotsChart').getContext('2d');
            timeSlotsChart = new Chart(timeSlotsCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(timeSlotCounts),
                    datasets: [{
                        label: 'Pacientes',
                        data: Object.values(timeSlotCounts),
                        backgroundColor: '#F59E0B'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if (programsChart) programsChart.destroy();
            if (healthByAgeChart) healthByAgeChart.destroy();
            if (citiesChart) citiesChart.destroy();
            if (timeSlotsChart) timeSlotsChart.destroy();
            createCharts();
        }

        // ========================================
        // FILTERS
        // ========================================
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const programFilter = document.getElementById('programFilter').value;
            const cityFilter = document.getElementById('cityFilter').value;

            filteredPatients = allPatients.filter(patient => {
                const matchesSearch = !searchTerm ||
                    patient.name.toLowerCase().includes(searchTerm) ||
                    patient.dni.includes(searchTerm) ||
                    CITY_NAMES[patient.city].toLowerCase().includes(searchTerm);

                const matchesProgram = !programFilter || patient.program === programFilter;
                const matchesCity = !cityFilter || patient.city === cityFilter;

                return matchesSearch && matchesProgram && matchesCity;
            });

            calculateKPIs();
            renderTable();
            updateCharts();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('programFilter').value = '';
            document.getElementById('cityFilter').value = '';

            filteredPatients = [...allPatients];
            calculateKPIs();
            renderTable();
            updateCharts();
        }

        // ========================================
        // EXPORT TO CSV
        // ========================================
        function exportToCSV() {
            const headers = ['DNI', 'Nombre', 'Edad', 'Ciudad', 'Programa', 'Inscrito', 'Agendado', 'Salud (%)', 'Puntos', 'Racha', '√öltima Actividad', 'Cl√≠nica', 'Horario'];

            const rows = filteredPatients.map(p => [
                p.dni,
                p.name,
                p.age,
                CITY_NAMES[p.city],
                PROGRAM_NAMES[p.program],
                p.enrolled ? 'S√≠' : 'No',
                p.scheduled ? 'S√≠' : 'No',
                p.health,
                p.points,
                p.streak,
                p.lastActivity,
                p.clinic || 'N/A',
                p.timeSlot || 'N/A'
            ]);

            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'pacientes_gemelo_digital_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ========================================
        // INITIALIZE
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            calculateKPIs();
            renderTable();
            createCharts();

            // Real-time search
            document.getElementById('searchInput').addEventListener('input', applyFilters);

            // Drag and drop support
            const uploadArea = document.getElementById('uploadArea');

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    handleFile(files[0]);
                } else {
                    showError('Por favor, sube un archivo PDF v√°lido.');
                }
            });
        });

        // ========================================
        // OCR MODAL FUNCTIONS
        // ========================================
        let selectedFile = null;

        function openOCRModal() {
            document.getElementById('ocrModal').style.display = 'block';
            resetModal();
        }

        function closeOCRModal() {
            document.getElementById('ocrModal').style.display = 'none';
            resetModal();
        }

        function resetModal() {
            selectedFile = null;
            document.getElementById('pdfFileInput').value = '';
            document.getElementById('fileSelected').style.display = 'none';
            document.getElementById('uploadButton').disabled = true;
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('resultPreview').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Validate file type
            if (file.type !== 'application/pdf') {
                showError('Solo se permiten archivos PDF.');
                return;
            }

            // Validate file size (10 MB max)
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showError('El archivo es demasiado grande. M√°ximo 10 MB.');
                return;
            }

            selectedFile = file;

            // Show file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileSelected').style.display = 'block';
            document.getElementById('uploadButton').disabled = false;

            // Hide previous results
            document.getElementById('resultPreview').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        async function uploadHistoriaClinica() {
            if (!selectedFile) {
                showError('Por favor, selecciona un archivo PDF.');
                return;
            }

            // Disable upload button
            const uploadButton = document.getElementById('uploadButton');
            uploadButton.disabled = true;
            uploadButton.textContent = 'Procesando...';

            // Show progress
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('progressFill').style.width = '30%';
            document.getElementById('progressText').textContent = 'Extrayendo texto del PDF...';

            // Create FormData
            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                // Determine API URL
                const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                const API_BASE = isLocalhost ? 'http://localhost:8000' : '';

                // Update progress
                document.getElementById('progressFill').style.width = '50%';
                document.getElementById('progressText').textContent = 'Estructurando datos con IA...';

                // Upload file
                const response = await fetch(`${API_BASE}/admin/upload-historia-clinica`, {
                    method: 'POST',
                    body: formData
                });

                // Update progress
                document.getElementById('progressFill').style.width = '80%';
                document.getElementById('progressText').textContent = 'Creando paciente en base de datos...';

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.detail || 'Error al procesar la historia cl√≠nica');
                }

                // Complete progress
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressText').textContent = '¬°Completado!';

                // Show success
                setTimeout(() => {
                    showSuccess(result);
                }, 500);

            } catch (error) {
                console.error('Error uploading historia cl√≠nica:', error);
                showError(error.message || 'Error al procesar la historia cl√≠nica. Por favor, intenta nuevamente.');

                // Reset button
                uploadButton.disabled = false;
                uploadButton.textContent = 'Procesar Historia Cl√≠nica';

                // Hide progress
                document.getElementById('progressContainer').style.display = 'none';
            }
        }

        function showSuccess(result) {
            // Hide progress
            document.getElementById('progressContainer').style.display = 'none';

            // Show success alert
            const successAlert = document.getElementById('successAlert');
            successAlert.textContent = `‚úÖ ${result.message} - ${result.patient_name}`;
            successAlert.style.display = 'block';

            // Show result preview
            const resultData = document.getElementById('resultData');
            resultData.innerHTML = `
                <strong>ID del Paciente:</strong> ${result.patient_id}<br>
                <strong>Nombre:</strong> ${result.patient_name}<br>
                <strong>Datos Extra√≠dos:</strong><br>
                <div style="margin-left: 20px; margin-top: 8px;">
                    ${formatExtractedData(result.extracted_data)}
                </div>
                <br>
                <strong>Pr√≥ximos pasos:</strong> ${result.next_steps}
            `;
            document.getElementById('resultPreview').style.display = 'block';

            // Reset button
            const uploadButton = document.getElementById('uploadButton');
            uploadButton.disabled = false;
            uploadButton.textContent = 'Procesar Historia Cl√≠nica';

            // Refresh page data after 2 seconds
            setTimeout(() => {
                window.location.reload();
            }, 3000);
        }

        function formatExtractedData(data) {
            let html = '';

            if (data.gender) html += `‚Ä¢ G√©nero: ${data.gender}<br>`;
            if (data.city) html += `‚Ä¢ Ciudad: ${data.city}<br>`;
            if (data.risk_level) html += `‚Ä¢ Nivel de Riesgo: ${data.risk_level}<br>`;
            if (data.conditions && data.conditions.length > 0) {
                html += `‚Ä¢ Condiciones: ${data.conditions.join(', ')}<br>`;
            }
            if (data.recommended_programs && data.recommended_programs.length > 0) {
                html += `‚Ä¢ Programas Recomendados: ${data.recommended_programs.join(', ')}<br>`;
            }

            return html || 'Datos estructurados guardados en base de datos';
        }

        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            errorAlert.textContent = `‚ùå ${message}`;
            errorAlert.style.display = 'block';

            // Hide progress
            document.getElementById('progressContainer').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('ocrModal');
            if (event.target === modal) {
                closeOCRModal();
            }
        }
    </script>

</body>
</html>
